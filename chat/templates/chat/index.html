<!DOCTYPE html>
<html>
<head>
    <title>Chat Room</title>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const username = "{{ request.user.username }}";  // Assuming you're using Django's user authentication

            const chatSocket = new WebSocket(
                'ws://' + window.location.host + '/ws/chat/'
            );

            chatSocket.onmessage = function(e) {
                const data = JSON.parse(e.data);
                const chatLog = document.querySelector('#chat-log');
                const newMessage = document.createElement('div');
                newMessage.textContent = `${data.timestamp ? '[' + data.timestamp + '] ' : ''}${data.username}: ${data.message}`;
                chatLog.appendChild(newMessage);
            };

            chatSocket.onclose = function(e) {
                console.error('Chat socket closed unexpectedly');
            };

            document.querySelector('#chat-message-submit').onclick = function(e) {
                const messageInputDom = document.querySelector('#chat-message-input');
                const message = messageInputDom.value;
                chatSocket.send(JSON.stringify({
                    'message': message,
                    'username': username
                }));
                messageInputDom.value = '';
            };
        });
    </script>
</head>
<body>
    <div class="row justify-content-center">
        <div class="col-md-8">
            <h2 class="mt-4">Chat Room</h2>
            <div id="chat-log" class="mt-3"></div>
            <div class="input-group mt-3">
                <input id="chat-message-input" type="text" class="form-control" placeholder="Enter your message">
                <div class="input-group-append">
                    <button id="chat-message-submit" class="btn btn-primary" type="button">Send</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
